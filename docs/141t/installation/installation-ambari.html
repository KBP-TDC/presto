
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Automated Installation with Ambari &mdash; Presto 0.141t Documentation</title>
    
    <link rel="stylesheet" href="../_static/presto.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.141t',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Presto 0.141t Documentation" href="../index.html" />
    <link rel="up" title="5. Presto Server Installation" href="../server-installation.html" />
    <link rel="next" title="Presto on Yarn-based cluster" href="installation-yarn.html" />
    <link rel="prev" title="5. Presto Server Installation" href="../server-installation.html" /> 
  </head>
  <body>
<div class="header">
    <h1 class="heading"><a href="../index.html">
        <span>Presto 0.141t Documentation</span></a></h1>
    <h2 class="heading"><span>Automated Installation with Ambari</span></h2>
</div>
<div class="topnav">
    
<p class="nav">
    <span class="left">
        &laquo; <a href="../server-installation.html">5. Presto Server Installation</a>
    </span>
    <span class="right">
        <a href="installation-yarn.html">Presto on Yarn-based cluster</a> &raquo;
    </span>
</p>

</div>
<div class="content">
    
  <div class="section" id="automated-installation-with-ambari">
<h1><a class="toc-backref" href="#id1">Automated Installation with Ambari</a></h1>
<p>Presto can be installed using Apache Ambari. To install Presto using Ambari you
need to have the <a class="reference external" href="https:www.teradata.com/presto">Presto Ambari Integration package</a>. These instructions <strong>do not describe how to
install Presto integrated with YARN using Ambari</strong>. For instructions how to do that follow
<a class="reference internal" href="installation-yarn.html"><em>Automated Installation with Ambari 2.1 with YARN integration</em></a>.</p>
<div class="contents topic" id="presto-ambari-integration">
<p class="topic-title first">Presto Ambari Integration</p>
<ul class="simple">
<li><a class="reference internal" href="#automated-installation-with-ambari" id="id1">Automated Installation with Ambari</a><ul>
<li><a class="reference internal" href="#requirements-for-integration" id="id2">Requirements for integration</a></li>
<li><a class="reference internal" href="#adding-the-presto-service" id="id3">Adding the Presto service</a></li>
<li><a class="reference internal" href="#supported-topologies" id="id4">Supported Topologies</a><ul>
<li><a class="reference internal" href="#pseudo-distributed" id="id5">Pseudo-distributed</a></li>
<li><a class="reference internal" href="#distributed" id="id6">Distributed</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-presto" id="id7">Configuring Presto</a><ul>
<li><a class="reference internal" href="#adding-and-removing-connectors" id="id8">Adding and removing connectors</a><ul>
<li><a class="reference internal" href="#known-issues" id="id9">Known issues</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="requirements-for-integration">
<h2><a class="toc-backref" href="#id2">Requirements for integration</a></h2>
<ol class="arabic simple">
<li>Red Hat Enterprise Linux 6.x (64-bit) or CentOS equivalent.</li>
<li>You must have Ambari installed and thus transitively fulfill <a class="reference external" href="http://docs.hortonworks.com/HDPDocuments/Ambari-2.1.2.1/bk_Installing_HDP_AMB/content/_meet_minimum_system_requirements.html">Ambari&#8217;s requirements</a>.</li>
<li>Oracle Java JDK 1.8 (64-bit). Note that when installing Ambari you will be prompted to pick a JDK. You can tell Ambari to download Oracle JDK 1.8 or point it to an existing installation. Presto picks up whatever JDK Ambari was installed with so it is imperative that Ambari is running on Oracle JDK 1.8.</li>
<li>Disable <tt class="docutils literal"><span class="pre">requiretty</span></tt>. On RHEL 6.x this can be done by editing the <tt class="docutils literal"><span class="pre">/etc/sudoers</span></tt> file and commenting out <tt class="docutils literal"><span class="pre">Defaults</span>&nbsp;&nbsp;&nbsp; <span class="pre">requiretty</span></tt>.</li>
<li>Install <tt class="docutils literal"><span class="pre">wget</span></tt> on all nodes that will run a Presto component.</li>
</ol>
</div>
<div class="section" id="adding-the-presto-service">
<h2><a class="toc-backref" href="#id3">Adding the Presto service</a></h2>
<p>This section and all others that follow walk you through the integration steps needed to get Presto working with Ambari. By default, this integration code installs the latest Teradata Presto release (0.141t).</p>
<p>To integrate the Presto service with Ambari, follow the steps outlined below:</p>
<ul class="simple">
<li>Assuming HDP 2.3 was installed with Ambari, create the following directory on the node where the <tt class="docutils literal"><span class="pre">ambari-server</span></tt> is running:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>mkdir /var/lib/ambari-server/resources/stacks/HDP/2.3/services/PRESTO
<span class="nv">$ </span><span class="nb">cd</span> /var/lib/ambari-server/resources/stacks/HDP/2.3/services/PRESTO
</pre></div>
</div>
<ul class="simple">
<li>Place the integration files within the newly created PRESTO directory by uploading the integration archive to your cluster and extracting it like so:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>tar -xvf /path/to/integration/package/ambari-presto-0.1.0.tar.gz -C /var/lib/ambari-server/resources/stacks/HDP/2.3/services/PRESTO
<span class="nv">$ </span>mv /var/lib/ambari-server/resources/stacks/HDP/2.3/services/PRESTO/ambari-presto-0.1.0/* /var/lib/ambari-server/resources/stacks/HDP/2.3/services/PRESTO
<span class="nv">$ </span>rm -rf /var/lib/ambari-server/resources/stacks/HDP/2.3/services/PRESTO/ambari-presto-0.1.0
</pre></div>
</div>
<ul class="simple">
<li>Finally, make all integration files executable and restart the Ambari server:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>chmod -R +x /var/lib/ambari-server/resources/stacks/HDP/2.3/services/PRESTO/*
<span class="nv">$ </span>ambari-server restart
</pre></div>
</div>
<ul class="simple">
<li>Once the server has restarted, point your browser to it and on the main Ambari Web UI page click the <tt class="docutils literal"><span class="pre">Add</span> <span class="pre">Service</span></tt> button and follow the on screen wizard to add Presto. The following sections provide more details on the options and choices you will make when adding Presto.</li>
</ul>
</div>
<div class="section" id="supported-topologies">
<h2><a class="toc-backref" href="#id4">Supported Topologies</a></h2>
<p>The following two screens will allow you to assign the Presto processes among the nodes in your cluster. Once you pick a topology for Presto and finish the installation process it is impossible to modify that topology.</p>
<p>Presto is composed of a coordinator and worker processes. The same code runs all nodes because the same Presto server RPM is installed for both workers and coordinator. It is the configuration on each node that determines how a particular node will behave. Presto can run in pseudo-distributed mode, where a single Presto process on one node acts as both coordinator and worker, or in distributed mode, where the Presto coordinator runs on one node and the Presto workers run on other nodes.</p>
<p>The client component of Presto is the <tt class="docutils literal"><span class="pre">presto-cli</span></tt> executable JAR. You should place it on all nodes where you expect to access the Presto server via this command line utility. The <tt class="docutils literal"><span class="pre">presto-cli</span></tt> executable JAR does not need to be co-located with either a worker or a coordinator, it can be installed on its own. Once installed, the CLI can be found at <tt class="docutils literal"><span class="pre">/usr/lib/presto/bin/presto-cli</span></tt>.</p>
<p><strong>Do not place a worker on the same node as a coordinator.</strong> Such an attempt will fail the installation because the integration software will attempt to install the RPM twice. In order to schedule work on the Presto coordinator, effectively turning the process into a dual worker/coordinator, please enable the <tt class="docutils literal"><span class="pre">node-scheduler.include-coordinator</span></tt> toggle available in the configuration screen.</p>
<div class="section" id="pseudo-distributed">
<h3><a class="toc-backref" href="#id5">Pseudo-distributed</a></h3>
<p>Pick a node for the Presto coordinator and <strong>do not assign any Presto workers</strong>. On the configuration screen that follows, you must also enable <tt class="docutils literal"><span class="pre">node-scheduler.include-coordinator</span></tt> by clicking the toggle.</p>
</div>
<div class="section" id="distributed">
<h3><a class="toc-backref" href="#id6">Distributed</a></h3>
<p>Pick a node for the Presto coordinator and assign as many Presto workers to nodes as you&#8217;d like. Feel free to also place the client component on any node. Remember to not place a worker on the same node as a coordinator.</p>
</div>
</div>
<div class="section" id="configuring-presto">
<span id="configuring-presto-label"></span><h2><a class="toc-backref" href="#id7">Configuring Presto</a></h2>
<p>The one configuration property that does not have a default and requires input is <tt class="docutils literal"><span class="pre">discovery.uri</span></tt>. The expected value is <tt class="docutils literal"><span class="pre">http://&lt;FQDN-of-node-hosting-coordinator&gt;:8081</span></tt>. Note that it is <tt class="docutils literal"><span class="pre">http</span></tt> and not <tt class="docutils literal"><span class="pre">https</span></tt> and that the port is <tt class="docutils literal"><span class="pre">8081</span></tt>. If you change the value of <tt class="docutils literal"><span class="pre">http-server.http.port</span></tt>, make sure to also change it in <tt class="docutils literal"><span class="pre">disovery.uri</span></tt>.</p>
<p>Some of the most popular properties are displayed in the Settings tab (open by default). In the Advanced tab, set custom properties by opening up the correct drop down and specifying a key and a value. Note that specifying a property that Presto does not recognize will cause the installation to finish with errors as some or all servers fail to start.</p>
<p>Change the Presto configuration after installation by selecting the Presto service followed by the Configs tab. After changing a configuration option, make sure to restart Presto for the changes to take effect.</p>
<p>If you are running a version of Ambari that is older than 2.1 (version less than 2.1), then you must omit the memory suffix (GB) when setting the following memory related configurations: <tt class="docutils literal"><span class="pre">query.max-memory-per-node</span></tt> and <tt class="docutils literal"><span class="pre">query.max-memory</span></tt>. For these two properties the memory suffix is automatically added by the integration software. For all other memory related configurations that you add as custom properties, you&#8217;ll have to include the memory suffix when specifying the value.</p>
<div class="section" id="adding-and-removing-connectors">
<h3><a class="toc-backref" href="#id8">Adding and removing connectors</a></h3>
<p>To add a connector modify the <tt class="docutils literal"><span class="pre">connectors.to.add</span></tt> property, whose format is the following: <tt class="docutils literal"><span class="pre">{'connector1':</span> <span class="pre">['key1=value1',</span> <span class="pre">'key2=value2',</span> <span class="pre">etc.],</span> <span class="pre">'connector2':</span> <span class="pre">['key3=value3',</span> <span class="pre">'key4=value4'],</span> <span class="pre">etc.}</span></tt>. Note the single quotes around each individual element. This property only adds connectors and will not delete connectors. Thus, if you add connector1, save the configuration, restart Presto, then specify {} for this property, connector1 will not be deleted. If you specify incorrect values in your connector settings, for example setting the <tt class="docutils literal"><span class="pre">hive.metastore.uri</span></tt> in the Hive connector to point to an invalid hostname, then Presto will fail to start.</p>
<p>For example, to add the Hive and Kafka connectors, set the <tt class="docutils literal"><span class="pre">connectors.to.add</span></tt> property to:</p>
<div class="highlight-none"><div class="highlight"><pre>{
    &#39;hive&#39;: [&#39;connector.name=hive-cdh4&#39;, &#39;hive.metastore.uri=thrift://example.net:9083&#39;],
    &#39;kafka&#39;: [&#39;connector.name=kafka&#39;, &#39;kafka.table-names=table1,table2&#39;, &#39;kafka.nodes=host1:port,host2:port&#39;]
}
</pre></div>
</div>
<p>To delete a connector modify the <tt class="docutils literal"><span class="pre">connectors.to.delete</span></tt> property, whose format is the following: <tt class="docutils literal"><span class="pre">['connector1',</span> <span class="pre">'connector2',</span> <span class="pre">etc.]</span></tt>. Again, note the single quotes around each element. The above value will delete connectors <tt class="docutils literal"><span class="pre">connector1</span></tt> and <tt class="docutils literal"><span class="pre">connector2</span></tt>. Note that the <tt class="docutils literal"><span class="pre">tpch</span></tt> connector cannot be deleted because it is used to smoketest Presto after it starts. The presence of the <tt class="docutils literal"><span class="pre">tpch</span></tt> connector has negligible impact on the system.</p>
<p>For example, to delete the Hive and Kafka connectors, set the <tt class="docutils literal"><span class="pre">connectors.to.delete</span></tt> property to: <tt class="docutils literal"><span class="pre">['hive',</span> <span class="pre">'kafka']</span></tt>.</p>
<div class="section" id="known-issues">
<h4><a class="toc-backref" href="#id9">Known issues</a></h4>
<ul class="simple">
<li>For some older versions of Presto, when attempting to <tt class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></tt> or <tt class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span> <span class="pre">AS</span></tt> using the Hive connector, you may run into the following error:</li>
</ul>
<div class="highlight-none"><div class="highlight"><pre>Query 20151120_203243_00003_68gdx failed: java.security.AccessControlException: Permission denied: user=hive, access=WRITE, inode=&quot;/apps/hive/warehouse/nation&quot;:hdfs:hdfs:drwxr-xr-x
             at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.check(FSPermissionChecker.java:319)
             at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:219)
             at org.apache.hadoop.hdfs.server.namenode.FSPermissionChecker.checkPermission(FSPermissionChecker.java:190)
             at org.apache.hadoop.hdfs.server.namenode.FSDirectory.checkPermission(FSDirectory.java:1771)
</pre></div>
</div>
<p>To work around the issue, edit your <tt class="docutils literal"><span class="pre">jvm.config</span></tt> settings by adding the following property <tt class="docutils literal"><span class="pre">-DHADOOP_USER_NAME=hive</span></tt>. This problem affects Presto <tt class="docutils literal"><span class="pre">0.115t</span></tt> but does not affect <tt class="docutils literal"><span class="pre">0.127t</span></tt>. After saving your edit to <tt class="docutils literal"><span class="pre">jvm.config</span></tt>, don&#8217;t forget to restart all Presto components in order for the changes to take effect.</p>
<ul class="simple">
<li>If you decide to deploy an older version of Presto, you may have to adjust some setting manually. Please see <a class="reference internal" href="#configuring-presto-label"><em>Configuring Presto</em></a> for an explanation of how to add custom settings. For example, the <tt class="docutils literal"><span class="pre">task.max-memory</span></tt> setting was deprecated in <tt class="docutils literal"><span class="pre">0.127t</span></tt> but is valid in <tt class="docutils literal"><span class="pre">0.115t</span></tt>. Therefore, if you&#8217;re installing <tt class="docutils literal"><span class="pre">0.115t</span></tt> and would like to change <tt class="docutils literal"><span class="pre">task.max-memory</span></tt> to something other than its default, add it as a custom property.</li>
<li>On the Presto service home page, if you click on &#8216;Presto workers&#8217;, you will get an incorrect list of workers. This is a known issue and has been fixed in Ambari 2.2.0.</li>
<li>If the installation of Presto fails with <tt class="docutils literal"><span class="pre">Python</span> <span class="pre">script</span> <span class="pre">has</span> <span class="pre">been</span> <span class="pre">killed</span> <span class="pre">due</span> <span class="pre">to</span> <span class="pre">timeout</span> <span class="pre">after</span> <span class="pre">waiting</span> <span class="pre">1800</span> <span class="pre">secs</span></tt>, then the <tt class="docutils literal"><span class="pre">wget</span></tt> for either the Presto RPM or <tt class="docutils literal"><span class="pre">presto-cli</span></tt> JAR has timed out. To increase the timeout, increase the <tt class="docutils literal"><span class="pre">agent.package.install.task.timeout</span></tt> setting in <tt class="docutils literal"><span class="pre">/etc/ambari-server/conf/ambari.properties</span></tt> on the Ambari server host. Make sure to restart the Ambari server for the change to take effect. To resume, either hit the Retry button in the installation wizard, or finish the wizard and then install all Presto components individually by navigating to the relevant host and selecting Re-install. The components can be installed manually in any order but when starting the components, make sure to start the Presto coordinator last. If the installation keeps timing out, we suggest downloading the RPM and JAR outside the installation process, uploading them somewhere on your network and editing <tt class="docutils literal"><span class="pre">package/scripts/download.ini</span></tt> with the new URLs.</li>
<li>At the moment, upgrading Presto from Ambari is not possible. Even though Ambari provides the capability to upgrade software, we didn&#8217;t get a chance to implement the integration. If many users request this feature (if you&#8217;d like to see this feature let us know by commenting on <a class="reference external" href="https://github.com/prestodb/ambari-presto-service/issues/17">this issue</a>), we&#8217;ll add it to the next release. To upgrade Presto without the native upgrade integration you have to manually uninstall Presto and then install the new version.</li>
</ul>
</div>
</div>
</div>
</div>


</div>
<div class="bottomnav">
    
<p class="nav">
    <span class="left">
        &laquo; <a href="../server-installation.html">5. Presto Server Installation</a>
    </span>
    <span class="right">
        <a href="installation-yarn.html">Presto on Yarn-based cluster</a> &raquo;
    </span>
</p>

</div>

    <div class="footer">
    </div>
  </body>
</html>