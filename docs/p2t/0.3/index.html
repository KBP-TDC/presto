<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Teradata QueryGrid: Presto-To-Teradata Database User Guide &mdash; Teradata QueryGrid (TM): Presto-To-Teradata Database 0.3 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Teradata QueryGrid (TM): Presto-To-Teradata Database 0.3 documentation" href="#" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="#">Teradata QueryGrid (TM): Presto-To-Teradata Database 0.3 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="teradata-querygrid-presto-to-teradata-database-user-guide">
<h1>Teradata QueryGrid: Presto-To-Teradata Database User Guide<a class="headerlink" href="#teradata-querygrid-presto-to-teradata-database-user-guide" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Teradata® QueryGrid™: Presto-To-Teradata Database (henceforth known as &#8220;P2T&#8221;) provides a SQL interface
to query the Teradata Database from Presto. <a class="reference external" href="http://teradata.github.io/presto/docs/141t/">Presto</a>
is a SQL query engine for big data that provides access to many data sources, including Hadoop ecosystem databases
like Hive and traditional databases like MySQL and PostgreSQL.</p>
<p>You can issue queries from Presto with P2T that do the following:</p>
<ul class="simple">
<li>Import data from Teradata Database tables and store it in Hadoop or one of the databases that Presto has a connector for.</li>
<li>Export data from Presto into an existing table in the Teradata Database.</li>
<li>Select data from Teradata tables and join it with existing Hadoop or other Presto data.</li>
</ul>
<p>P2T additionally performs push-down of simple predicates and selects only the columns needed for the SQL
statement, in order to reduce the amount of data that needs to be retrieved. For a list of supported pushdown,
see <a class="reference internal" href="#predicate-pushdown">Predicate Pushdown</a>.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>P2T is compatible with versions of the Teradata database in the 15.00 and 15.10 releases.
The minimum version for the 15.00 release is 15.00.04. The minimum version for the 15.10 release is 15.10.01.01.
The Teradata database must have Java 8 installed. Additionally, there are recommended changes to the Teradata
JVM properties that greatly improve performance, as described here: <a class="reference internal" href="#jvm-configuration">JVM Configuration</a>. Changing the JVM properties
on the Teradata database requires a database restart.</p>
<p>Only Presto version 0.141t is supported with this version of P2T.</p>
<p>These installation instructions use the <code class="docutils literal"><span class="pre">presto-admin</span></code> utility, described <a class="reference external" href="http://teradata.github.io/presto/docs/current/installation/presto-admin/user-guide.html">here</a>.
The administrator needs sudo and ssh access to all of the Presto nodes to install a new connector with <code class="docutils literal"><span class="pre">presto-admin</span></code>.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>To install P2T, you must install a driver on Teradata, one or more P2T foreign servers on Teradata,
and a connector on Presto.</p>
<p>Before starting installation, upload <code class="docutils literal"><span class="pre">presto-to-teradata-driver.zip</span></code> to both
the Teradata and Presto clusters and unzip it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">unzip</span> <span class="n">presto</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">teradata</span><span class="o">-</span><span class="n">driver</span><span class="o">.</span><span class="n">zip</span> <span class="o">-</span><span class="n">d</span> <span class="n">presto</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">teradata</span><span class="o">-</span><span class="n">driver</span>
<span class="n">cd</span> <span class="n">presto</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">teradata</span><span class="o">-</span><span class="n">driver</span>
</pre></div>
</div>
<dl class="docutils">
<dt>The archive contains the following:</dt>
<dd><ul class="first last simple">
<li>the Teradata driver jar file, <code class="docutils literal"><span class="pre">presto-to-teradata-driver.jar</span></code></li>
<li>the RPM file to be installed on the Presto cluster, <code class="docutils literal"><span class="pre">presto-to-teradata-connector-*.noarch.rpm</span></code></li>
<li>the sample properties files to be copied to the Presto cluster, <code class="docutils literal"><span class="pre">properties/teradata.properties</span></code></li>
<li>the install script for the driver on Teradata, <code class="docutils literal"><span class="pre">install_p2t.bteq</span></code></li>
<li>the uninstall script for the driver on Teradata, <code class="docutils literal"><span class="pre">uninstall_p2t.bteq</span></code></li>
<li>this documentation</li>
</ul>
</dd>
</dl>
<div class="section" id="installation-on-teradata">
<h3>Installation on Teradata<a class="headerlink" href="#installation-on-teradata" title="Permalink to this headline">¶</a></h3>
<div class="section" id="privileges-and-security">
<h4>Privileges and Security<a class="headerlink" href="#privileges-and-security" title="Permalink to this headline">¶</a></h4>
<p>P2T uses two Teradata accounts: a DBA user and a user that will run queries on the foreign server.</p>
<p>The DBA user (henceforth known as <cite>dba_user</cite>) is usually <cite>dbc</cite> or a user with similar permissions,
and it installs the driver in the <cite>syslib</cite> database.</p>
<p>Grant the following permissions to <cite>dba_user</cite>:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">EXECUTE</span> <span class="k">PROCEDURE</span> <span class="k">ON</span> <span class="n">sqlj</span> <span class="k">TO</span> <span class="n">dba_user</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">PROCEDURE</span> <span class="k">ON</span> <span class="n">syslib</span> <span class="k">TO</span> <span class="n">dba_user</span> <span class="k">WITH</span> <span class="k">GRANT</span> <span class="k">OPTION</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">CREATE</span> <span class="k">FUNCTION</span> <span class="k">ON</span> <span class="n">syslib</span> <span class="k">TO</span> <span class="n">dba_user</span><span class="p">;</span>
</pre></div>
</div>
<p>The user that will be running queries (henceforth known as <cite>presto_user</cite>) can either be an
existing user or a new user. That user must have sufficient spool space
for the query workload: the spool space must be at least as large as the amount of data used in the query.</p>
<p>Grant the following permissions to <cite>presto_user</cite>:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">GRANT</span> <span class="k">SELECT</span> <span class="k">ON</span> <span class="n">td_server_db</span> <span class="k">TO</span> <span class="n">presto_user</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">CREATE</span> <span class="n">SERVER</span> <span class="k">ON</span> <span class="n">td_server_db</span> <span class="k">TO</span> <span class="n">presto_user</span><span class="p">;</span>
<span class="k">GRANT</span> <span class="k">DROP</span> <span class="n">SERVER</span> <span class="k">ON</span> <span class="n">td_server_db</span> <span class="k">TO</span> <span class="n">presto_user</span><span class="p">;</span>
</pre></div>
</div>
<p>P2T foreign servers should not be queried directly by Teradata users, so it is recommended to limit access to foreign servers to <code class="docutils literal"><span class="pre">presto_user</span></code> only.</p>
</div>
<div class="section" id="jvm-configuration">
<h4>JVM Configuration<a class="headerlink" href="#jvm-configuration" title="Permalink to this headline">¶</a></h4>
<p>P2T requires additional Java Virtual Machine (JVM) options. For best performance, it is recommended to
use the Java G1 garbage collector and increase the JVM heap size to 30GB. Note that you need to have 30GB of memory free on the
Teradata machine to do this; if not, you will need to set <code class="docutils literal"><span class="pre">-Xms</span></code> and <code class="docutils literal"><span class="pre">-Xmx</span></code> to a lower value.
In order to set these JVM options, run the following commands on any Teradata node:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cufconfig</span> <span class="o">-</span><span class="n">o</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">JVMOptions</span> <span class="o">&gt;</span> <span class="n">old_jvmoptions</span><span class="o">.</span><span class="n">txt</span>
<span class="n">echo</span> <span class="s2">&quot;JVMOptions: -Xms30g -Xmx30g -XX:+UseG1GC -XX:G1HeapRegionSize=32M -XX:+ExplicitGCInvokesConcurrent&quot;</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">jre_config</span><span class="p">;</span>
<span class="n">cufconfig</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">jre_config</span><span class="p">;</span>
<span class="n">tpareset</span> <span class="s1">&#39;JVMOptions has been changed&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">cufconfig</span> <span class="pre">-f</span></code> overwrites the existing JVM properties. To list the existing properties, run <code class="docutils literal"><span class="pre">cufconfig</span> <span class="pre">-o</span></code>.</p>
</div>
</div>
<div class="section" id="driver-installation">
<h4>Driver Installation<a class="headerlink" href="#driver-installation" title="Permalink to this headline">¶</a></h4>
<p>To install the driver, execute the following commands as <cite>dba_user</cite>, replacing ${DBA_USER} with the DBA user,
${PRESTO_USER} with the user that will query from the foreign server, and ${PATH_TO_P2T_DRIVER_JAR} with
the local path to the <code class="docutils literal"><span class="pre">presto-to-teradata-driver.jar</span></code> file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DATABASE syslib;

-- Execute following commands as an admin user (${DBA_USER})
-- Grant rights...
GRANT EXECUTE PROCEDURE ON sqlj TO ${DBA_USER};
GRANT CREATE EXTERNAL PROCEDURE ON syslib TO ${DBA_USER} WITH GRANT OPTION;
GRANT CREATE FUNCTION ON syslib TO ${DBA_USER};

GRANT SELECT ON td_server_db TO ${PRESTO_USER};
GRANT CREATE SERVER ON td_server_db TO ${PRESTO_USER};
GRANT DROP SERVER ON td_server_db TO ${PRESTO_USER};

-- Upload driver...
call sqlj.install_jar(&#39;CJ!${PATH_TO_P2T_DRIVER_JAR}&#39;, &#39;presto_teradata_driver_p2t&#39;, 0)

-- Create transport functions...
CREATE FUNCTION presto_to_teradata_import()
    RETURNS TABLE VARYING USING FUNCTION presto_to_td_import_contract
    LANGUAGE JAVA NO SQL
    PARAMETER STYLE SQLTABLE
    READS EXTERNAL DATA
    EXTERNAL NAME &#39;presto_teradata_driver_p2t:com.teradata.ptl.P2TImportDriver.execute&#39;;

GRANT EXECUTE FUNCTION ON syslib.presto_to_teradata_import TO ${PRESTO_USER};
GRANT SELECT ON syslib.presto_to_teradata_import TO ${PRESTO_USER};

CREATE FUNCTION presto_to_teradata_export()
    RETURNS TABLE VARYING USING FUNCTION presto_to_td_export_contract
    LANGUAGE JAVA NO SQL
    PARAMETER STYLE SQLTABLE
    MODIFIES EXTERNAL DATA
    EXTERNAL NAME &#39;presto_teradata_driver_p2t:com.teradata.ptl.P2TExportDriver.execute&#39;;

GRANT EXECUTE FUNCTION ON syslib.presto_to_teradata_export TO ${PRESTO_USER};
GRANT SELECT ON syslib.presto_to_teradata_export TO ${PRESTO_USER};
</pre></div>
</div>
<p>In the installer package, there is a script called <code class="docutils literal"><span class="pre">install_p2t.bteq</span></code> containing these commands. In
that script, ${DBA_USER} and ${PRESTO_USER} must be set to the appropriate user names.</p>
</div>
<div class="section" id="foreign-server-creation">
<h4>Foreign Server Creation<a class="headerlink" href="#foreign-server-creation" title="Permalink to this headline">¶</a></h4>
<p>After installing the driver, create one or more foreign servers.
The Presto connector(s) connect to the foreign server(s) on Teradata.</p>
<p>The CREATE FOREIGN SERVER command has the following syntax:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>CREATE FOREIGN SERVER ${FOREIGN_SERVER_NAME}
USING
  PARAM1(&#39;value1&#39;)
  PARAM2(&#39;value2&#39;)
  ...
  PARAMN(&#39;valuen&#39;)
DO IMPORT WITH syslib.presto_to_teradata_import,
DO EXPORT WITH syslib.presto_to_teradata_export;
</pre></div>
</div>
<p>${FOREIGN_SERVER_NAME} must be a valid object name in Teradata. PARAM1 to PARAMN
are name value pairs (NVPs). Some NVPs are required to create a functional
foreign server &#8211; see <a class="reference internal" href="#required-name-value-pairs">Required Name Value Pairs</a> &#8211; while others are necessary for connecting
to particular Presto servers &#8211; see <a class="reference internal" href="#optional-name-value-pairs">Optional Name Value Pairs</a>.  Other NVPs can be used
to tune P2T performance given your expected workload &#8211; see the <a class="reference internal" href="#configuration">Configuration</a> section.</p>
<p>If the Presto host is located on 192.0.2.3, a minimal foreign server definition is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">FOREIGN</span> <span class="n">SERVER</span> <span class="n">p2t</span>
<span class="n">USING</span>
  <span class="n">HOSTTYPE</span><span class="p">(</span><span class="s1">&#39;NVP&#39;</span><span class="p">)</span>
  <span class="n">TRANSPORT_COORDINATOR_IP</span><span class="p">(</span><span class="s1">&#39;192.0.2.3&#39;</span><span class="p">)</span>
<span class="n">DO</span> <span class="n">IMPORT</span> <span class="n">WITH</span> <span class="n">syslib</span><span class="o">.</span><span class="n">presto_to_teradata_import</span><span class="p">,</span>
<span class="n">DO</span> <span class="n">EXPORT</span> <span class="n">WITH</span> <span class="n">syslib</span><span class="o">.</span><span class="n">presto_to_teradata_export</span><span class="p">;</span>
</pre></div>
</div>
<p>See the sections below for more information on the required and optional configuration parameters.</p>
<div class="section" id="required-name-value-pairs">
<h5>Required Name Value Pairs<a class="headerlink" href="#required-name-value-pairs" title="Permalink to this headline">¶</a></h5>
<p>The following required name value pairs (NVPs) must be added to the USING clause. NVPs are
specified with the form NVP_NAME(&#8216;value&#8217;) &#8211; e.g. HOSTTYPE(&#8216;NVP&#8217;).</p>
<dl class="docutils">
<dt><strong>HOSTTYPE</strong></dt>
<dd>For P2T, this is the string &#8216;NVP&#8217;.</dd>
<dt><strong>TRANSPORT_COORDINATOR_IP</strong></dt>
<dd>The IP address or hostname of the data exchange coordinator, accessible from the Teradata hosts.
This value must match the host provided in the <code class="docutils literal"><span class="pre">data-exchange.coordinator.host-and-port</span></code>
property in the Presto configuration in <span class="xref std std-ref">connector_installation</span>, and usually is the same
as the Presto coordinator.</dd>
</dl>
</div>
<div class="section" id="optional-name-value-pairs">
<h5>Optional Name Value Pairs<a class="headerlink" href="#optional-name-value-pairs" title="Permalink to this headline">¶</a></h5>
<p>Additional name value pairs (NVPs) may be needed to connect the Teradata and Presto servers.
These NVPs can be specified after the required NVPs with the form NVP_NAME(&#8216;value&#8217;)
&#8211; e.g. TRANSPORT_COORDINATOR_PORT(&#8216;21313&#8217;).</p>
<dl class="docutils">
<dt><strong>TRANSPORT_COORDINATOR_PORT</strong></dt>
<dd>The port used by P2T to transfer data. This value must match the port number provided in
the <code class="docutils literal"><span class="pre">data-exchange.server.port</span></code> property in the Presto configuration in <span class="xref std std-ref">connector_installation</span>.
If not specified, the default is 21338.</dd>
</dl>
</div>
</div>
<div class="section" id="drop-foreign-servers">
<h4>Drop foreign servers<a class="headerlink" href="#drop-foreign-servers" title="Permalink to this headline">¶</a></h4>
<p>To remove a foreign server, execute the following command as <cite>presto_user</cite>, or some user with DROP FOREIGN SERVER privileges on the
server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>DROP FOREIGN SERVER ${FOREIGN_SERVER_NAME};
</pre></div>
</div>
</div>
<div class="section" id="uninstall-driver">
<h4>Uninstall Driver<a class="headerlink" href="#uninstall-driver" title="Permalink to this headline">¶</a></h4>
<p>The driver can be uninstalled only after dropping all of the foreign servers. To uninstall the driver, execute the following command as <cite>dba_user</cite>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DATABASE</span> <span class="n">syslib</span><span class="p">;</span>

<span class="n">DROP</span> <span class="n">FUNCTION</span> <span class="n">presto_to_teradata_import</span><span class="p">;</span>
<span class="n">DROP</span> <span class="n">FUNCTION</span> <span class="n">presto_to_teradata_export</span><span class="p">;</span>

<span class="n">CALL</span> <span class="n">sqlj</span><span class="o">.</span><span class="n">remove_jar</span><span class="p">(</span><span class="s1">&#39;presto_teradata_driver_p2t&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>In the installer package there is a script called <code class="docutils literal"><span class="pre">uninstall_p2t.bteq</span></code> that contains these commands.</p>
<p>After uninstalling P2T, it is recommended that you restart your Teradata Database to clean up resources allocated by the driver.
Restarting Teradata is necessary before reinstalling or upgrading P2T. To restart Teradata, issue the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tpareset</span> <span class="s2">&quot;QueryGrid driver has been uninstalled.&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="installation-on-presto">
<h3>Installation on Presto<a class="headerlink" href="#installation-on-presto" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>Privileges and Security<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>All users of Presto have access to the P2T connector. The connector respects the privileges in Teradata for
the tables that it reads from and writes to. If the <code class="docutils literal"><span class="pre">teradata.connection.user</span></code> property is set
in Presto to <cite>presto_user</cite>, <code class="docutils literal"><span class="pre">SHOW</span> <span class="pre">SCHEMAS</span></code>, <code class="docutils literal"><span class="pre">SHOW</span> <span class="pre">TABLES</span></code>, and <code class="docutils literal"><span class="pre">DESCRIBE</span> <span class="pre">&lt;TABLE&gt;</span></code>
will show schemas, tables, and columns for which <cite>presto_user</cite> has INSERT and/or SELECT privileges.
To issue an <code class="docutils literal"><span class="pre">INSERT</span> <span class="pre">INTO</span></code> or <code class="docutils literal"><span class="pre">SELECT</span></code> query on a table, the user needs INSERT or SELECT
privileges respectively. On Teradata, the user needs SELECT privileges for
the <code class="docutils literal"><span class="pre">dbc</span></code> system tables.</p>
</div>
<div class="section" id="connector-installation">
<h4>Connector Installation<a class="headerlink" href="#connector-installation" title="Permalink to this headline">¶</a></h4>
<p>To install P2T on Presto:</p>
<ol class="arabic">
<li><p class="first">Install the presto-to-teradata-connector RPM:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">presto</span><span class="o">-</span><span class="n">admin</span> <span class="n">package</span> <span class="n">install</span> <span class="n">presto</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">teradata</span><span class="o">-</span><span class="n">connector</span><span class="o">-*.</span><span class="n">noarch</span><span class="o">.</span><span class="n">rpm</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="2">
<li><p class="first">Copy <code class="docutils literal"><span class="pre">properties/teradata.properties</span></code> from the package zip file to <code class="docutils literal"><span class="pre">/etc/opt/prestoadmin/connectors</span></code>.
Your <code class="docutils literal"><span class="pre">/etc/opt/prestoadmin/connectors/teradata.properties</span></code> file will be as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">connector</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">teradata</span>
<span class="n">data</span><span class="o">-</span><span class="n">exchange</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">port</span><span class="o">=</span><span class="mi">21338</span>
<span class="n">data</span><span class="o">-</span><span class="n">exchange</span><span class="o">.</span><span class="n">coordinator</span><span class="o">.</span><span class="n">host</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">port</span><span class="o">=&lt;</span><span class="n">PRESTO</span><span class="o">-</span><span class="n">HOST</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">21338</span>
<span class="n">teradata</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">url</span><span class="o">=</span><span class="n">jdbc</span><span class="p">:</span><span class="n">teradata</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">TERADATA</span><span class="o">-</span><span class="n">HOST</span><span class="o">&gt;</span>
<span class="n">teradata</span><span class="o">.</span><span class="n">foreign</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">name</span><span class="o">=</span><span class="n">p2t</span>
<span class="n">teradata</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="o">=&lt;</span><span class="n">USERNAME_ON_TERADATA</span><span class="o">&gt;</span>
<span class="n">teradata</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">password</span><span class="o">=&lt;</span><span class="n">PASSWORD_FOR_ABOVE_USER</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>Replace <strong>&lt;PRESTO-HOST&gt;</strong> with the actual Presto coordinator hostname or IP reachable by
Teradata. If bynet is configured, make sure to use the bynet IP or a hostname that resolves to the
bynet IP so that network traffic uses the fastest possible connection.</p>
<p>Replace <strong>&lt;TERADATA-HOST&gt;</strong> with the hostname or IP of Teradata reachable by
Presto.</p>
<p>If the foreign server created above in <a class="reference internal" href="#foreign-server-creation">Foreign Server Creation</a> is not named <cite>p2t</cite>,
replace <cite>p2t</cite> with that foreign server name in <code class="docutils literal"><span class="pre">teradata.foreign-server-name</span></code>.</p>
<p>Replace <strong>&lt;USERNAME_ON_TERADATA&gt;</strong> and <strong>&lt;PASSWORD_FOR_ABOVE_USER&gt;</strong> with a user that has SELECT and INSERT
privileges for the foreign server.</p>
<p>Additional configuration properties may be found in the <a class="reference internal" href="#configuration">Configuration</a> section.</p>
</div></blockquote>
<ol class="arabic" start="3">
<li><p class="first">Deploy the P2T connector configuration using presto-admin:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">presto</span><span class="o">-</span><span class="n">admin</span> <span class="n">connector</span> <span class="n">add</span> <span class="n">teradata</span>
</pre></div>
</div>
</li>
<li><p class="first">Restart Presto:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">presto</span><span class="o">-</span><span class="n">admin</span> <span class="n">server</span> <span class="n">restart</span>
</pre></div>
</div>
</li>
<li><p class="first">Use the <a class="reference external" href="http://teradata.github.io/presto/docs/current/installation/cli.html">Presto CLI</a> to ensure that the P2T connector is installed:</p>
</li>
</ol>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">presto</span> <span class="o">--</span><span class="n">server</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span> <span class="o">--</span><span class="n">catalog</span> <span class="n">system</span> <span class="o">--</span><span class="n">schema</span> <span class="n">default</span>
<span class="n">presto</span><span class="p">:</span><span class="n">default</span><span class="o">&gt;</span> <span class="n">show</span> <span class="n">catalogs</span><span class="p">;</span>
  <span class="n">Catalog</span>
<span class="o">-----------</span>
 <span class="o">...</span>
 <span class="n">teradata</span>
 <span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If running the CLI on any node but the Presto coordinator, substitute the Presto coordinator hostname/IP for &#8220;localhost&#8221; in the above command.</p>
</div>
<p>It is possible to add multiple Teradata connectors with different properties by having a different name.
For example, you can add a connector specified in <code class="docutils literal"><span class="pre">other_teradata.properties</span></code> which connects to a
different Teradata Database, for which the connector name will be <cite>other_teradata</cite>.
When adding another Teradata connector, it is necessary to use a different port value for <strong>data-exchange.server.port</strong>.</p>
<p>Additional configuration is necessary in order to run P2T with Kerberos authentication.
For a detailed description of how to configure Kerberos, see <a class="reference internal" href="#kerberos-support">Kerberos Support</a>.</p>
</div>
</div>
</div>
<div class="section" id="querying-teradata-with-p2t">
<h2>Querying Teradata with P2T<a class="headerlink" href="#querying-teradata-with-p2t" title="Permalink to this headline">¶</a></h2>
<p>In Presto, <a class="reference external" href="http://teradata.github.io/presto/docs/current/connector.html">connectors</a> allow access to different data sources.
P2T uses a Teradata connector in Presto. The connector is configured via a configuration file placed in Presto&#8217;s catalog directory (see <a class="reference internal" href="#installation-on-presto">Installation on Presto</a>).
For example, a connector specified in <code class="docutils literal"><span class="pre">teradata.properties</span></code> can be queried via the following syntax:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">teradata</span><span class="o">.&lt;</span><span class="n">schema</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;.&lt;</span><span class="n">table</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">teradata</span><span class="o">.&lt;</span><span class="n">schema</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;.&lt;</span><span class="n">table</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">hive</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">nation</span><span class="p">;</span>
</pre></div>
</div>
<p>To show the schemas in Teradata:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SHOW</span> <span class="n">SCHEMAS</span> <span class="n">IN</span> <span class="n">teradata</span><span class="p">;</span>
</pre></div>
</div>
<p>To show tables in Teradata:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SHOW</span> <span class="n">TABLES</span> <span class="n">IN</span> <span class="n">teradata</span><span class="o">.&lt;</span><span class="n">schema</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>To show table metadata for a given Teradata table:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">presto</span><span class="p">:</span><span class="n">test_presto_user</span><span class="o">&gt;</span> <span class="n">describe</span> <span class="n">teradata</span><span class="o">.</span><span class="n">test_presto_user</span><span class="o">.</span><span class="n">nation</span><span class="p">;</span>
   <span class="n">Column</span>    <span class="o">|</span>  <span class="n">Type</span>   <span class="o">|</span> <span class="n">Null</span> <span class="o">|</span> <span class="n">Partition</span> <span class="n">Key</span> <span class="o">|</span> <span class="n">Comment</span>
<span class="o">-------------+---------+------+---------------+---------</span>
 <span class="n">n_nationkey</span> <span class="o">|</span> <span class="n">bigint</span>  <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">false</span>         <span class="o">|</span>
 <span class="n">n_name</span>      <span class="o">|</span> <span class="n">varchar</span> <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">false</span>         <span class="o">|</span>
 <span class="n">n_regionkey</span> <span class="o">|</span> <span class="n">bigint</span>  <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">false</span>         <span class="o">|</span>
 <span class="n">n_comment</span>   <span class="o">|</span> <span class="n">varchar</span> <span class="o">|</span> <span class="n">true</span> <span class="o">|</span> <span class="n">false</span>         <span class="o">|</span>
<span class="p">(</span><span class="mi">4</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>For extensive documentation of the syntax available in Presto, see the <a class="reference external" href="http://teradata.github.io/presto/docs/current/index.html">Presto documentation</a>.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="data-exchange-configuration">
<h3>Data exchange configuration<a class="headerlink" href="#data-exchange-configuration" title="Permalink to this headline">¶</a></h3>
<p>The following properties control the data exchange. They can be set for both Presto and Teradata:</p>
<blockquote>
<div><ul class="simple">
<li><strong>data-exchange.server.buffer-size</strong> - query results write buffer size. This buffer is shared between all
the queries that are in progress. When set on Presto, this property sets the buffer size when exporting
data from Presto to Teradata (e.g. <code class="docutils literal"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">teradata...</span></code>). When set on Teradata, it indicates
the import buffer size (e.g.  <code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">teradata..</span></code>). If not specified, the default is 2GB.</li>
<li><strong>data-exchange.server.port</strong> - data exchange server port. If not specified, the default is 21338.</li>
<li><strong>data-exchange.client.buffer-size</strong> - query results read buffer size. This buffer is shared between all
the queries that are in progress. When set on Presto, this property sets the buffer size when importing
data from Teradata to Presto (e.g. <code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">teradata..</span></code>). When set on Teradata, it indicates the
export buffer size (e.g. <code class="docutils literal"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">teradata...</span></code>). If not specified, the default is 2GB.</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Buffer sizes must be specified in human readable data size notation: 100MB, 1GB, 1TB</p>
</div>
<p>The <code class="docutils literal"><span class="pre">data-exchange.server.buffer-size</span></code> and <code class="docutils literal"><span class="pre">data-exchange.client.buffer-size</span></code> properties may need to be changed if latency in the system
causes the buffers to fill up. This will cause increased memory usage by P2T.</p>
<p>The <code class="docutils literal"><span class="pre">data-exchange.server-port</span></code> property
must be changed if the port 21338 is not free. If the port on Presto is changed, <strong>TRANSPORT_COORDINATOR_PORT</strong> in the foreign
server definition, as described in <a class="reference internal" href="#optional-name-value-pairs">Optional Name Value Pairs</a>, must also be changed to match.</p>
<p>To change a property for Presto, edit the P2T connector configuration file (<code class="docutils literal"><span class="pre">/etc/opt/prestoadmin/connectors/teradata.properties</span></code>).
To apply your changes, distribute the new properties file to all Presto nodes and restart the Presto server::</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">./</span><span class="n">presto</span><span class="o">-</span><span class="n">admin</span> <span class="n">connector</span> <span class="n">add</span> <span class="n">teradata</span>
<span class="n">sudo</span> <span class="o">./</span><span class="n">presto</span><span class="o">-</span><span class="n">admin</span> <span class="n">server</span> <span class="n">restart</span>
</pre></div>
</div>
<p>For Teradata, the data exchange properties are shared across all P2T foreign servers. In order to change a static property
for Teradata, you must set a JVM system property in the following format: <code class="docutils literal"><span class="pre">-Dp2t.property.name=value</span></code>.
Properties for the Teradata JVM can be set using the <strong>cufconfig</strong> utility. To apply your changes, you must
restart the Teradata database using the <strong>tpareset</strong> command.</p>
</div>
<div class="section" id="compression">
<h3>Compression<a class="headerlink" href="#compression" title="Permalink to this headline">¶</a></h3>
<p>If the network bandwidth is the bottleneck, data compression may increase throughput at the cost of increased CPU utilization.
Data compression can be enabled for a particular foreign server/Presto connector pair using the <strong>teradata.compression</strong> property.
If it is not specified, the data is not compressed.</p>
<p>On Presto, add the property to <code class="docutils literal"><span class="pre">teradata.properties</span></code>, and then restart the server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">teradata</span><span class="o">.</span><span class="n">compression</span><span class="o">=&lt;</span><span class="n">compression_algorithm</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The two options for compression_algorithm are <strong>LZ4</strong> and <strong>SNAPPY</strong>. Both algorithms are focused on compression and decompression speed.
Compression ratio and compression speed may vary for different queries and data sets.</p>
</div>
<div class="section" id="query-timeouts">
<h3>Query Timeouts<a class="headerlink" href="#query-timeouts" title="Permalink to this headline">¶</a></h3>
<p>P2T contains several query timeout mechanisms.</p>
<div class="section" id="read-timeout">
<h4>Read Timeout<a class="headerlink" href="#read-timeout" title="Permalink to this headline">¶</a></h4>
<p>The read timeout (default: 2h) determines the maximum amount of time waiting for query results.
It is recommended to increase this value for queries that require complex computation before returning any data.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">teradata</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">table</span> <span class="n">SELECT</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">some_huge_table</span><span class="p">;</span>
</pre></div>
</div>
<p>To create an appropriate foreign server with a read timeout of 3 days:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">FOREIGN</span> <span class="n">SERVER</span> <span class="n">p2t_read_timeout</span>
<span class="n">USING</span>
  <span class="n">HOSTTYPE</span><span class="p">(</span><span class="s1">&#39;NVP&#39;</span><span class="p">)</span>
  <span class="n">TRANSPORT_COORDINATOR_IP</span><span class="p">(</span><span class="s1">&#39;192.0.2.3&#39;</span><span class="p">)</span>
  <span class="n">ReadTimeout</span><span class="p">(</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">DO</span> <span class="n">IMPORT</span> <span class="n">WITH</span> <span class="n">syslib</span><span class="o">.</span><span class="n">presto_to_teradata_import</span><span class="p">,</span>
<span class="n">DO</span> <span class="n">EXPORT</span> <span class="n">WITH</span> <span class="n">syslib</span><span class="o">.</span><span class="n">presto_to_teradata_export</span><span class="p">;</span>
</pre></div>
</div>
<p>Optionally, additional name value pairs like <strong>TRANSPORT_COORDINATOR_PORT</strong> or <strong>WriteTimeout</strong> may be specified.</p>
<p>Set the read timeout on Presto to 3 days as well, by adding the following properties to <code class="docutils literal"><span class="pre">teradata.properties</span></code>,
and then restarting the server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">teradata</span><span class="o">.</span><span class="n">read_timeout</span><span class="o">=</span><span class="mi">3</span><span class="n">d</span>
<span class="n">teradata</span><span class="o">.</span><span class="n">foreign</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">presto_server</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Timeouts must have both a number and a unit: for example, 10s, 5m, or 2h.</p>
</div>
<div class="section" id="write-timeout">
<h4>Write Timeout<a class="headerlink" href="#write-timeout" title="Permalink to this headline">¶</a></h4>
<p>The write timeout (default: 1h) determines maximum amount of time waiting for consumer to consume the results.
It can be updated by adding a P2T name value pair <strong>WriteTimeout</strong> (see below) and
setting the Presto session variable <strong>teradata.write_timeout</strong>.
It is recommended to increase this value for queries for which Presto will have to wait a long time for Teradata to
consume the data, e.g. queries that require complex computation after consuming the data or pass a lot of data.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">teradata</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">table</span> <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">some_large_table</span><span class="p">;</span>
</pre></div>
</div>
<p>To create an appropriate foreign server with a write timeout of 3 days:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">FOREIGN</span> <span class="n">SERVER</span> <span class="n">p2t_write_timeout</span>
<span class="n">USING</span>
  <span class="n">HOSTTYPE</span><span class="p">(</span><span class="s1">&#39;NVP&#39;</span><span class="p">)</span>
  <span class="n">TRANSPORT_COORDINATOR_IP</span><span class="p">(</span><span class="s1">&#39;192.0.2.3&#39;</span><span class="p">)</span>
  <span class="n">WriteTimeout</span><span class="p">(</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">DO</span> <span class="n">IMPORT</span> <span class="n">WITH</span> <span class="n">syslib</span><span class="o">.</span><span class="n">presto_to_teradata_import</span><span class="p">,</span>
<span class="n">DO</span> <span class="n">EXPORT</span> <span class="n">WITH</span> <span class="n">syslib</span><span class="o">.</span><span class="n">presto_to_teradata_export</span><span class="p">;</span>
</pre></div>
</div>
<p>Optionally, additional name value pairs like <strong>TRANSPORT_COORDINATOR_PORT</strong> or <strong>ReadTimeout</strong> may be specified.</p>
<p>Set the write timeout on Presto to 3 days as well, by adding the following properties to <code class="docutils literal"><span class="pre">teradata.properties</span></code>,
and then restarting the server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">teradata</span><span class="o">.</span><span class="n">write_timeout</span><span class="o">=</span><span class="mi">3</span><span class="n">d</span>
<span class="n">teradata</span><span class="o">.</span><span class="n">foreign</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">name</span><span class="o">=&lt;</span><span class="n">presto_server</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Timeouts must have both a number and a unit: for example, 10s, 5m, or 2h.</p>
</div>
</div>
<div class="section" id="logging-on-teradata">
<h3>Logging on Teradata<a class="headerlink" href="#logging-on-teradata" title="Permalink to this headline">¶</a></h3>
<p>In order to turn on diagnostics/debug logging on Teradata, add the following property to <code class="docutils literal"><span class="pre">teradata.properties</span></code> and restart the Presto server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">teradata</span><span class="o">.</span><span class="n">debug</span><span class="o">-</span><span class="n">enabled</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>When enabled, the logs are in <code class="docutils literal"><span class="pre">/tmp/jlog-CURRENT_DATE.txt</span></code> on the Teradata node.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There is a large amount of output, so in most cases debugging should not be enabled.</p>
</div>
</div>
<div class="section" id="logging-on-presto">
<h3>Logging on Presto<a class="headerlink" href="#logging-on-presto" title="Permalink to this headline">¶</a></h3>
<p>To adjust the log debug levels on Presto, follow the instructions about adjusting the log level
in the Presto <a class="reference external" href="http://teradata.github.io/presto/docs/141t/configuration/configuration.html#log-levels">documentation</a>.</p>
</div>
<div class="section" id="jvm-configuration-in-presto">
<h3>JVM Configuration in Presto<a class="headerlink" href="#jvm-configuration-in-presto" title="Permalink to this headline">¶</a></h3>
<p>In Presto you can change JVM properties by editing the <code class="docutils literal"><span class="pre">jvm.config</span></code> file. In particular, if you face frequent out-of-memory
errors on the Presto workers, you should consider adding additional memory to Presto (by increasing <code class="docutils literal"><span class="pre">-Xmx</span></code>).
<code class="docutils literal"><span class="pre">jvm.config</span></code>   can be easily distributed across the cluster using the <code class="docutils literal"><span class="pre">presto-admin</span></code> utility.
Please refer to the <code class="docutils literal"><span class="pre">presto-admin</span></code> <a class="reference external" href="http://teradata.github.io/presto/docs/current/installation/presto-admin/user-guide.html">documentation</a> for more details.</p>
</div>
</div>
<div class="section" id="kerberos-support">
<h2>Kerberos Support<a class="headerlink" href="#kerberos-support" title="Permalink to this headline">¶</a></h2>
<p>It is possible to connect to Teradata via Kerberos. Before doing so, you need to set up Teradata
to authenticate via Kerberos. To do that, see the documentation for Teradata <a class="reference external" href="http://www.info.teradata.com/HTMLPubs/DB_TTU_15_00/index.html#page/Database_Management/B035_1100_015K/Defining_UM_Strategy.102.14.html">15.00</a>
or <a class="reference external" href="http://www.info.teradata.com/htmlpubs/DB_TTU_15_10/index.html#page/Database_Management/B035_1100_151K/Defining_UM_Strategy.101.14.html">15.10</a>.</p>
<p>In order to connect to Teradata via Kerberos:</p>
<ol class="arabic">
<li><p class="first">Create a Kerberos principal with a password that you will use to connect to Teradata. All queries from Presto to
Teradata will be run via this principal.</p>
</li>
<li><p class="first">Create a Teradata user with the same name as the above Kerberos principal. That user needs to be granted WITH NULL
PASSWORD permissions. For example, given a Kerberos principal <cite>Test_User</cite>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">USER</span> <span class="n">Test_User</span> <span class="n">AS</span> <span class="n">PERMANENT</span><span class="o">=&lt;</span><span class="n">permsize</span><span class="o">&gt;</span> <span class="n">SPOOL</span><span class="o">=&lt;</span><span class="n">spoolsize</span><span class="o">&gt;</span> <span class="n">TEMPORARY</span><span class="o">=&lt;</span><span class="n">tempsize</span><span class="o">&gt;</span> <span class="n">PASSWORD</span><span class="o">=</span><span class="s2">&quot;&lt;password&gt;&quot;</span><span class="p">;</span>
<span class="n">GRANT</span> <span class="n">LOGON</span> <span class="n">ON</span> <span class="n">ALL</span> <span class="n">TO</span> <span class="n">Test_User</span> <span class="n">WITH</span> <span class="n">NULL</span> <span class="n">PASSWORD</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p class="first">Grant INSERT access to the P2T foreign server, if the foreign server was created with a different user than the Kerberos principal:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">GRANT</span> <span class="n">INSERT</span> <span class="n">ON</span> <span class="n">TD_SERVER_DB</span><span class="o">.</span><span class="n">p2t</span> <span class="n">TO</span> <span class="o">&lt;</span><span class="n">principal</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Ensure that the <code class="docutils literal"><span class="pre">/etc/krb5.conf</span></code> file specifies a restricted keyset. The following lines must be included in <code class="docutils literal"><span class="pre">/etc/krb5.conf</span></code>
on both the Presto cluster and the Teradata cluster:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">default_tgs_enctypes</span> <span class="o">=</span> <span class="n">arcfour</span><span class="o">-</span><span class="n">hmac</span> <span class="n">des3</span><span class="o">-</span><span class="n">cbc</span><span class="o">-</span><span class="n">sha1</span> <span class="n">des</span><span class="o">-</span><span class="n">cbc</span><span class="o">-</span><span class="n">md5</span>
<span class="n">default_tkt_enctypes</span> <span class="o">=</span> <span class="n">arcfour</span><span class="o">-</span><span class="n">hmac</span> <span class="n">des3</span><span class="o">-</span><span class="n">cbc</span><span class="o">-</span><span class="n">sha1</span> <span class="n">des</span><span class="o">-</span><span class="n">cbc</span><span class="o">-</span><span class="n">md5</span>
</pre></div>
</div>
</li>
<li><p class="first">On Presto, add the following additional configuration properties to <code class="docutils literal"><span class="pre">teradata.properties</span></code>, using the principal
created above as the user and the Kerberos password as the password, and restart the Presto server:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">teradata</span><span class="o">.</span><span class="n">authentication</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">KERBEROS</span>
<span class="n">teradata</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">user</span><span class="o">=&lt;</span><span class="n">principal</span><span class="o">&gt;</span>
<span class="n">teradata</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">password</span><span class="o">=&lt;</span><span class="n">password</span><span class="o">&gt;</span>
<span class="n">teradata</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">kerberos</span><span class="o">.</span><span class="n">realm</span><span class="o">=&lt;</span><span class="n">realm</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please note that though usernames in the Teradata database are not case sensitive, all Kerberos entities,
including principals and realms, are case sensitive. Thus, using the above example, the principal must be
<cite>Test_User</cite>.</p>
</div>
<ol class="arabic" start="6">
<li><p class="first">Add the following property to the <code class="docutils literal"><span class="pre">jvm.config</span></code> for both the coordinator and the workers:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">Djava</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="o">.</span><span class="n">config</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">presto</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">plugin</span><span class="o">/</span><span class="n">teradata</span><span class="o">/</span><span class="n">TeraJDBC</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><code class="docutils literal"><span class="pre">jvm.config</span></code> can be easily distributed across the cluster using the <code class="docutils literal"><span class="pre">presto-admin</span></code> utility.
Please refer to the <code class="docutils literal"><span class="pre">presto-admin</span></code> <a class="reference external" href="https://prestodb.io/presto-admin/presto-admin-commands.html#configuration-deploy">documentation</a> for more details.</div></blockquote>
</div>
<div class="section" id="technical-specification">
<h2>Technical specification<a class="headerlink" href="#technical-specification" title="Permalink to this headline">¶</a></h2>
<div class="section" id="type-support">
<h3>Type support<a class="headerlink" href="#type-support" title="Permalink to this headline">¶</a></h3>
<p>The following table refers to type handling/conversion between Teradata and Presto.
Type handling can differ between Presto connectors or even between storage types
within a connector. Please refer to the documentation for specific Presto connectors
for more details.</p>
<p>Type conversions from Teradata to Presto:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="14%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type in Teradata</th>
<th class="head">Type in Presto</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>BYTEINT</td>
<td>BIGINT</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>SMALLINT</td>
<td>BIGINT</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>INTEGER</td>
<td>BIGINT</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>BIGINT</td>
<td>BIGINT</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>REAL</td>
<td>DOUBLE</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>DECIMAL(X,Y)</td>
<td>DECIMAL(X,Y)</td>
<td>Max precision in both Presto and Teradata is 38; scale &lt;= precision</td>
</tr>
<tr class="row-even"><td>CHAR</td>
<td>VARCHAR</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>VARCHAR</td>
<td>VARCHAR</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>DATE</td>
<td>DATE</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>TIMESTAMP</td>
<td>TIMESTAMP</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>BYTE</td>
<td>VARBINARY</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>VARBYTE</td>
<td>VARBINARY</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>JSON</td>
<td>VARCHAR</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Presto&#8217;s TIMESTAMP type is not SQL standard. When given a timestamp literal like TIMESTAMP &#8216;1988-04-08 00:00:00&#8217;,
Presto interprets and stores it in the user time zone, rather than without a time zone as is the SQL standard. Teradata
follows the SQL standard. Thus, in order to ensure that the TIMESTAMP values are interpreted properly, it is best to
run the Presto server in UTC (by either setting the JVM time zone or setting the time zone via the JDBC driver).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For DECIMAL, Presto does not perform any implicit conversions on INSERT INTO, so the values being inserted
must match the type of the column exactly, including precision and scale. Constant decimal values have a
precision of the number of digits in the number and scale of the number of fractional digits, so they
may need a cast. e.g. <code class="docutils literal"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">decimal_8_2</span> <span class="pre">VALUES</span> <span class="pre">(CAST(1.0</span> <span class="pre">AS</span> <span class="pre">DECIMAL(8,</span> <span class="pre">2)))</span></code></p>
</div>
</div>
</div>
<div class="section" id="predicate-pushdown">
<h2>Predicate Pushdown<a class="headerlink" href="#predicate-pushdown" title="Permalink to this headline">¶</a></h2>
<p>P2T can push all projections and some predicates down to Teradata, to limit data transfer. The supported predicates are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">IS</span> <span class="pre">NULL</span></code> and <code class="docutils literal"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code></li>
<li><code class="docutils literal"><span class="pre">IN</span></code> and <code class="docutils literal"><span class="pre">NOT</span> <span class="pre">IN</span></code></li>
<li><code class="docutils literal"><span class="pre">=</span></code>, <code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code>, <code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code>, <code class="docutils literal"><span class="pre">BETWEEN...AND</span></code></li>
<li><code class="docutils literal"><span class="pre">OR</span></code> and <code class="docutils literal"><span class="pre">AND</span></code> of the above predicates (though <code class="docutils literal"><span class="pre">OR</span></code> predicates must be on the same column)</li>
</ul>
</div>
<div class="section" id="known-issues-limitations">
<h2>Known issues/limitations<a class="headerlink" href="#known-issues-limitations" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The maximum VARCHAR size is 31232B, rather than the Teradata limit of 64K</li>
<li>Currently the maximum number of concurrent queries is 20. However, if your queries are long running or take a lot of resources (e.g. if they have a large result set), it is advised to run less than 20 queries.</li>
<li>If you get an error message stating &#8220;Another instance of the Querygrid driver is still running.&#8221;, please restart your Teradata instance with the <strong>tpareset &#8216;reason&#8217;</strong> command.</li>
<li>TIMESTAMP WITH TIME ZONE and DATE WITH TIME ZONE are not currently supported.</li>
<li>It is not possible to access the dbc system tables via P2T, even if the user has proper permissions.</li>
<li>When installing more than one Teradata Presto connector, it is necessary to use different port values for <strong>data-exchange.server.port</strong>.</li>
<li>If a Teradata table contains types not supported by Presto, an <code class="docutils literal"><span class="pre">INSERT</span> <span class="pre">INTO</span></code> query will fail</li>
<li><code class="docutils literal"><span class="pre">SELECT</span></code> queries will return only the columns of supported Presto types (unless there are no columns with Presto supported types, in which case the <code class="docutils literal"><span class="pre">SELECT</span></code> will fail).</li>
<li>Since Teradata does not have a BOOLEAN type, in order to insert a Presto BOOLEAN column into Teradata you must cast that column to BIGINT.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Teradata QueryGrid: Presto-To-Teradata Database User Guide</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#installation-on-teradata">Installation on Teradata</a><ul>
<li><a class="reference internal" href="#privileges-and-security">Privileges and Security</a></li>
<li><a class="reference internal" href="#jvm-configuration">JVM Configuration</a></li>
<li><a class="reference internal" href="#driver-installation">Driver Installation</a></li>
<li><a class="reference internal" href="#foreign-server-creation">Foreign Server Creation</a><ul>
<li><a class="reference internal" href="#required-name-value-pairs">Required Name Value Pairs</a></li>
<li><a class="reference internal" href="#optional-name-value-pairs">Optional Name Value Pairs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#drop-foreign-servers">Drop foreign servers</a></li>
<li><a class="reference internal" href="#uninstall-driver">Uninstall Driver</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation-on-presto">Installation on Presto</a><ul>
<li><a class="reference internal" href="#id1">Privileges and Security</a></li>
<li><a class="reference internal" href="#connector-installation">Connector Installation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#querying-teradata-with-p2t">Querying Teradata with P2T</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a><ul>
<li><a class="reference internal" href="#data-exchange-configuration">Data exchange configuration</a></li>
<li><a class="reference internal" href="#compression">Compression</a></li>
<li><a class="reference internal" href="#query-timeouts">Query Timeouts</a><ul>
<li><a class="reference internal" href="#read-timeout">Read Timeout</a></li>
<li><a class="reference internal" href="#write-timeout">Write Timeout</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logging-on-teradata">Logging on Teradata</a></li>
<li><a class="reference internal" href="#logging-on-presto">Logging on Presto</a></li>
<li><a class="reference internal" href="#jvm-configuration-in-presto">JVM Configuration in Presto</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kerberos-support">Kerberos Support</a></li>
<li><a class="reference internal" href="#technical-specification">Technical specification</a><ul>
<li><a class="reference internal" href="#type-support">Type support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#predicate-pushdown">Predicate Pushdown</a></li>
<li><a class="reference internal" href="#known-issues-limitations">Known issues/limitations</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="#">Teradata QueryGrid (TM): Presto-To-Teradata Database 0.3 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Teradata Corporation.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>